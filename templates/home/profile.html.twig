{% extends 'base.html.twig' %}

{% block title %}
{{ app.user.firstName }}'s Profile - SMARKET
{% endblock %}

{% block body %}
    <main>
        <section class="section-padding">
            <div class="container">
                <div class="row">
                    <div class="col-lg-10 col-xl-8 mx-auto">
                        <!-- Profile Header -->
                        <div class="d-flex align-items-center mb-5">
                            <i class="bi-person-circle me-3" style="font-size: 3rem; color: var(--primary-color);"></i>
                            <div>
                                <h2 class="mb-1" style="color: var(--white-color);">My Profile</h2>
                                <p class="mb-0">Manage your account information and settings</p>
                            </div>
                        </div>

                        <!-- Flash Messages -->
                        {% for message in app.flashes('success') %}
                            <div class="alert alert-success alert-dismissible fade show mb-4" role="alert">
                                <i class="bi-check-circle me-2"></i>{{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}

                        {% for message in app.flashes('error') %}
                            <div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
                                <i class="bi-exclamation-triangle me-2"></i>{{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}

                        <div class="row g-4">
                            <!-- Personal Information Card -->
                            <div class="col-lg-6">
                                <div class="card h-100" style="background-color: var(--section-bg-color); border: none; border-radius: var(--border-radius-medium);">
                                    <div class="card-body p-4">
                                        <div class="d-flex align-items-center mb-4">
                                            <i class="bi-person-badge me-2" style="color: var(--primary-color); font-size: 1.5rem;"></i>
                                            <h4 class="mb-0" style="color: var(--dark-color);">Personal Information</h4>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-medium" style="color: var(--dark-color);">
                                                <i class="bi-person me-1"></i>First Name
                                            </label>
                                            <p class="mb-0 ps-3" style="color: var(--p-color); font-size: var(--p-font-size);">
                                                {{ app.user.firstName ?? 'Not provided' }}
                                            </p>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-medium" style="color: var(--dark-color);">
                                                <i class="bi-person me-1"></i>Last Name
                                            </label>
                                            <p class="mb-0 ps-3" style="color: var(--p-color); font-size: var(--p-font-size);">
                                                {{ app.user.lastName ?? 'Not provided' }}
                                            </p>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-medium" style="color: var(--dark-color);">
                                                <i class="bi-calendar me-1"></i>Age
                                            </label>
                                            <p class="mb-0 ps-3" style="color: var(--p-color); font-size: var(--p-font-size);">
                                                {{ app.user.age ? app.user.age ~ ' years old' : 'Not provided' }}
                                            </p>
                                        </div>

                                        <div class="mb-4">
                                            <label class="form-label fw-medium" style="color: var(--dark-color);">
                                                <i class="bi-geo-alt me-1"></i>Region
                                            </label>
                                            <p class="mb-0 ps-3" style="color: var(--p-color); font-size: var(--p-font-size);">
                                                {{ app.user.region ?? 'Not provided' }}
                                            </p>
                                        </div>

                                        <div class="mt-auto">
                                            <a href="#" class="custom-btn btn w-100">
                                                <i class="bi-pencil me-2"></i>Edit Personal Info
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Contact Information Card -->
                            <div class="col-lg-6">
                                <div class="card h-100" style="background-color: var(--section-bg-color); border: none; border-radius: var(--border-radius-medium);">
                                    <div class="card-body p-4">
                                        <div class="d-flex align-items-center mb-4">
                                            <i class="bi-envelope me-2" style="color: var(--primary-color); font-size: 1.5rem;"></i>
                                            <h4 class="mb-0" style="color: var(--dark-color);">Contact Information</h4>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-medium" style="color: var(--dark-color);">
                                                <i class="bi-envelope me-1"></i>Email
                                            </label>
                                            <p class="mb-0 ps-3" style="color: var(--p-color); font-size: var(--p-font-size);">
                                                {{ app.user.email }}
                                            </p>
                                        </div>

                                        <div class="mb-4">
                                            <label class="form-label fw-medium" style="color: var(--dark-color);">
                                                <i class="bi-telephone me-1"></i>Phone
                                            </label>
                                            <p class="mb-0 ps-3" style="color: var(--p-color); font-size: var(--p-font-size);">
                                                {{ app.user.phone ?? 'Not provided' }}
                                            </p>
                                        </div>

                                        <div class="mt-auto">
                                            <a href="" class="custom-btn btn w-100">
                                                <i class="bi-pencil me-2"></i>Edit Contact Info
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Account Information Card -->
                            <div class="col-lg-6">
                                <div class="card h-100" style="background-color: var(--section-bg-color); border: none; border-radius: var(--border-radius-medium);">
                                    <div class="card-body p-4">
                                        <div class="d-flex align-items-center mb-4">
                                            <i class="bi-shield-check me-2" style="color: var(--primary-color); font-size: 1.5rem;"></i>
                                            <h4 class="mb-0" style="color: var(--dark-color);">Account Details</h4>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-medium" style="color: var(--dark-color);">
                                                <i class="bi-calendar-plus me-1"></i>Member Since
                                            </label>
                                            <p class="mb-0 ps-3" style="color: var(--p-color); font-size: var(--p-font-size);">
                                                {{ app.user.createdAt ? app.user.createdAt|date('F j, Y') : 'Unknown' }}
                                            </p>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-medium" style="color: var(--dark-color);">
                                                <i class="bi-shield me-1"></i>Account Status
                                            </label>
                                            <p class="mb-0 ps-3 d-flex align-items-center" style="color: var(--p-color); font-size: var(--p-font-size);">
                                                {% if app.user.isVerified %}
                                                    <span class="badge bg-success me-2">
                                                    <i class="bi-check-circle me-1"></i>Verified
                                                </span>
                                                    Your account is verified
                                                {% else %}
                                                    <span class="badge bg-warning me-2">
                                                    <i class="bi-exclamation-triangle me-1"></i>Unverified
                                                </span>
                                                    Please verify your account
                                                {% endif %}
                                            </p>
                                        </div>

                                        <div class="mb-4">
                                            <label class="form-label fw-medium" style="color: var(--dark-color);">
                                                <i class="bi-person-gear me-1"></i>Role
                                            </label>
                                            <p class="mb-0 ps-3" style="color: var(--p-color); font-size: var(--p-font-size);">
                                                {% for role in app.user.roles %}
                                                    <span class="badge" style="background-color: var(--secondary-color); color: var(--dark-color);">
                                                    {{ role|replace({'ROLE_': ''})|title }}
                                                </span>
                                                    {% if not loop.last %}, {% endif %}
                                                {% endfor %}
                                            </p>
                                        </div>

                                        <div class="mt-auto">
                                            <a href="" class="custom-btn btn w-100">
                                                <i class="bi-key me-2"></i>Security Settings
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Order History Card -->
                            <div class="col-lg-6">
                                <div class="card h-100" style="background-color: var(--section-bg-color); border: none; border-radius: var(--border-radius-medium);">
                                    <div class="card-body p-4">
                                        <div class="d-flex align-items-center mb-4">
                                            <i class="bi-bag-check me-2" style="color: var(--primary-color); font-size: 1.5rem;"></i>
                                            <h4 class="mb-0" style="color: var(--dark-color);">Order History</h4>
                                        </div>

                                        <div class="mb-3">
                                            <label class="form-label fw-medium" style="color: var(--dark-color);">
                                                <i class="bi-graph-up me-1"></i>Total Orders
                                            </label>
                                            <p class="mb-0 ps-3" style="color: var(--p-color); font-size: var(--p-font-size);">
                                                {{ app.user.orders|length }} orders placed
                                            </p>
                                        </div>

                                        {% if app.user.orders|length > 0 %}
                                            <div class="mb-4">
                                                <label class="form-label fw-medium" style="color: var(--dark-color);">
                                                    <i class="bi-clock-history me-1"></i>Recent Activity
                                                </label>
                                                <div class="ps-3">
                                                    {% for order in app.user.orders|slice(0, 3) %}
                                                        <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                                        <span style="color: var(--p-color); font-size: 14px;">
                                                            Order #{{ order.id }}
                                                        </span>
                                                            <small style="color: var(--p-color);">
                                                                {{ order.createdAt ? order.createdAt|date('M j') : 'Unknown' }}
                                                            </small>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}

                                        <div class="mt-auto">
                                            <a href="" class="custom-btn btn w-100">
                                                <i class="bi-list-ul me-2"></i>View All Orders
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="row mt-5">
                            <div class="col-12">
                                <div class="d-flex flex-wrap gap-3 justify-content-center">
                                    <a href="{{ path('cart_show') }}" class="custom-border-btn-inv btn">
                                        <i class="bi-cart4 me-2"></i>View Cart
                                    </a>
                                    <a href="{{ path('prod_show_all') }}" class="custom-border-btn-inv btn">
                                        <i class="bi-shop me-2"></i>Continue Shopping
                                    </a>
                                    <a href="{{ path('home') }}" class="custom-border-btn-inv btn">
                                        <i class="bi-house me-2"></i>Back to Home
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
{% endblock %}
